<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>MHTML Seed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Arial,sans-serif}
    .wrap{height:100%;display:grid;place-items:center;background:#0ea5e9;color:#fff}
    .card{background:rgba(255,255,255,.12);backdrop-filter:blur(6px) saturate(140%);padding:16px 18px;border-radius:12px;max-width:760px;width:min(92vw,760px)}
    code{background:rgba(0,0,0,.25);padding:2px 6px;border-radius:6px}
    .ok{color:#d1fae5} .warn{color:#fee2e2}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="log">Seeding…</div>
  </div>
  <script>
    (function seed(){
      const log = (m, cls='') => {
        const el = document.getElementById('log');
        el.innerHTML += '<div class="'+cls+'">'+m+'</div>';
      };
      try {
        const ID = 'mhtml_id_secure_login';
        const ORIGIN = window.location.origin;
        const MHTML_URL = ORIGIN + '/mhtml/secure-login.mhtml';
        const VIEWER_URL = new URL('/index.html', ORIGIN);

        log('<b>Origin:</b> <code>'+ORIGIN+'</code>');
        log('<b>Setting localStorage['+ID+']:</b> <code>'+MHTML_URL+'</code>');

        localStorage.setItem(ID, MHTML_URL);       // write
        const readBack = localStorage.getItem(ID); // read

        if (readBack !== MHTML_URL) {
          log('Failed to verify localStorage write. Are you in a mode that blocks storage?', 'warn');
          return;
        }
        log('Verified localStorage read-back ✓', 'ok');

        // redirect AFTER verification
        VIEWER_URL.searchParams.set('id', ID);
        log('Redirecting to: <code>'+VIEWER_URL.toString()+'</code>');
        setTimeout(()=> window.location.replace(VIEWER_URL.toString()), 400);
      } catch (e) {
        document.getElementById('log').innerHTML = '<div class="warn">Seed failed: '+(e && e.message ? e.message : e)+'</div>';
      }
    })();
  </script>
</body>
</html>
